<!DOCTYPE html>
<html lang="en">
        <head>
               <% include ../view/partials/head %>
        </head>
        <header>
                <% include ../view/partials/navBar %>
        </header>
   <body>
      
                <div class="container">
                        <h1 class="jumbotron">
                                Node js Socket io Chat Application
         <% if(!everyauth.loggedIn) { %>
                                <h4>
                                        Faça
                                        <a href="/login">
                                                login
                                        </a>
                                        (
                                        <a href="/auth/facebook">
                                                Facebook
                                        </a>
                                        ) 
                  ou
                                        <a href="/register">
                                                registe-se
                                        </a>
                                        .
                                </h4>
                                <% } else { %>
                                <h4>
                                        Bem-vindo, 
               <% if(everyauth.user) { %> 
               <%    user = everyauth.user; %>
               <% } else if(everyauth.facebook) { %>
               <%    user = everyauth.facebook.user; %>
               <% } %>

               <%= user.name %>!
                                </h4>
                                <a href="/logout">
                                        Logout
                                </a>
                                <div class="row" id="privateChat" style="margin-top: 70px;">
                                        <div class="col-md-6">
                                                <select id="comboUser" @change="filtarMeng()">
                                                        <option value="-1">
                                                                Escolha o utilizador
                                                        </option>
                                                        <option v-bind:value="user.username" v-for="user in users">
                                                                {{ user.name }} ({{ user.username }})
                                                        </option>
                                                </select>
                                        </div>
                                        <div class="col-md-6">
                                                <h3>
                                                        Mensagens pessoais
                                                </h3>
                                                <div class="chatArea" id="prChat">
                                                        <div class="well" v-for="prMessage in prMessages">
                                                                <div style="float:left;">
                                                                        {{ prMessage.sender }}
                                                                </div>
                                                                <div style="display: inline-block; margin:0 auto;">
                                                                        {{ prMessage.text }}
                                                                </div>
                                        
                                                                <div style="float:right;">
                                                                        <i>
                                                                                {{ prMessage.timestamp }}
                                                                        </i>
                                                                </div>
                                                        </div>
                                                </div>
                                                <form id="prForm">
                                                        <div class="form-group">
                                                                <textarea class="form-control" cols="5" id="prTxt" rows="5">
                                                                </textarea>
                                                        </div>
                                                        <div class="form-group">
                                                                <button class="btn btn-success" type="submit">
                                                                        Send
                                                                </button>
                                                        </div>
                                                </form>
                                        </div>
                                </div>
                                <script>
                                addVuePrChat(<%- JSON.stringify(users) %>,<%- JSON.stringify(prMessages) %>,"<%= user.username %>");    
                                </script>
                                <% } %>
                        </h1>
                        <div class="row" id="publicChat" style="margin-top: 70px;">
                                <div class="col-md-4">
                                </div>
                                <div class="col-md-6">
                                        <h3>
                                                Chat público
                                        </h3>
                                        <div class="chatArea" id="pubChat">
                                                
                                                <div class="well" v-for="pubMessage in pubMessages">
                                                        <div style="float:left;" v-if="pubMessage.name">
                                                                {{ pubMessage.name}}
                                                        </div>
                                                        <div style="float:left;" v-else>
                                                                Desconhecido
                                                        </div>
                                                        <div style="display: inline-block; margin:0 auto;">
                                                                {{ pubMessage.text }}
                                                        </div>
                                                        <div style="float:right;">
                                                                <i>
                                                                        {{ pubMessage.timestamp }}
                                                                </i>
                                                        </div>
                                                </div>
                                              
                                        </div>
                                        <form id="pubForm">
                                                <div class="form-group">
                                                        <textarea class="form-control" cols="5" id="pubTxt" rows="5">
                                                        </textarea>
                                                </div>
                                                <div class="form-group">
                                                        <button class="btn btn-success" type="submit">
                                                                Send
                                                        </button>
                                                </div>
                                        </form>
                                </div>
                        </div>
                        <script>
                                addVuePubChat(<%- JSON.stringify(pubMessages) %>);
                        </script>
                </div>
        </body>
</html>
